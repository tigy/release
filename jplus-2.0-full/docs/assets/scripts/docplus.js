/** * @author  */var DocPlus = {		// 配置		options: {		sidebarWidth: 200	},		loadOptions: function(){		DocPlus.options = LocalStorage.getJSON('docOptions') || DocPlus.options;	},		saveOptions: function(){		LocalStorage.setJSON('docOptions', DocPlus.options);	},		// 界面		updateSplitter: function(sidebarWidth){		Dom.get('sidebar').setWidth(sidebarWidth - 10);		Dom.get('splitter').setOffset({x: sidebarWidth - 3});		Dom.get('content').setWidth(document.getSize().x - sidebarWidth - 12);		DocPlus.options.sidebarWidth = sidebarWidth;	},		/**	 * 当窗口更改大小之后，刷新页面布局。	 */	updateLayout: function(){		var height = document.getSize().y - Dom.get('header').getSize().y;		Dom.get('splitter').setHeight(height);		height -= 10;		Dom.get('doctree').setHeight(height - Dom.get('sidebar-toolbar').getSize().y - 16);				Dom.get('content').setHeight(height);		DocPlus.updateSplitter(DocPlus.options.sidebarWidth);	},		// 选项卡		tabs: {},		tabCount: 0,		TabPage: Class({				constructor: function(name, options){			this.name = name;			var title = this.title = options.title || name || '　';			this.header = Dom.create('li');			Dom.create('a', 'x-closebutton')				.setAttr('href', 'javascript://关闭 ' +title)				.setText('×')				.on('click', this.close, this)				.appendTo(this.header);							Dom.create('a')				.setAttr('href', '#' + name)				.setAttr('title', title)				.setText(title)				.appendTo(this.header);							this.header.on('mouseup', this.onHeaderMouseUp, this);			this.header.on('contextmenu', this.onHeaderContextMenu, this);			Dom.get('tabs').append(this.header);						this.content = this.initContent(options);			Dom.get('content').append(this.content);			DocPlus.tabCount++;			DocPlus.relayoutTab();		},				initContent: function(options){			if(options.url){				return Dom.create('iframe', 'content').setAttr('frameborder', '0').setAttr('src', options.url);			}			return Dom.create('div', 'content').setHtml(this.name);		},				onHeaderMouseUp: function(e){						switch(e.which){								// // 鼠标左键。
				// case 1:
					// this.active();
					// break;									// 鼠标中键。				case 2:					e.stop();					this.close();					break;			}					},				active: function () {						var currentTabPage = DocPlus.currentTab;						if(currentTabPage) {								if(currentTabPage === this)					return;									currentTabPage.deactive();				currentTabPage.nextTabPage = this;				this.previousTabPage = currentTabPage;							}						this.header.addClass('selected');			this.content.show();						DocPlus.currentTab = this;		},				deactive: function () {			this.header.removeClass('selected');			this.content.hide();
		},				updateTitle: function(maxLength){			var title = this.title;			this.titleLabel.setText(String.ellipsis(title, maxLength));			 maxLength;		},				onHeaderContextMenu: function(e){			this.active();			var menu = new ContextMenu();			menu.items.add('aa').on('click', function(){alert('a')});			menu.showAt(e.pageX, e.pageY);			e.stop();		},				close: function(){						var p = this.previousTabPage, n = this.nextTabPage;									this.header.remove();			this.content.remove();						if(n)				n.previousTabPage = p;						if(p){				p.nextTabPage = n;			} 						if(DocPlus.currentTab === this){				DocPlus.currentTab = null;				p && p.active();			}						delete DocPlus.tabs[this.name];									DocPlus.tabCount--;			DocPlus.relayoutTab();		}			}),		closeOtherTabs: function(){		for(var i in DocPlus.tabs){			var t = DocPlus.tabs[i];			if(t !== DocPlus.currentTab){				t.close();				}		}	},		relayoutTab: function(){		//DocPlus.tabCount++;	},		openTab: function(name, options){		var tabPage = DocPlus.tabs[name];		if(!tabPage){			DocPlus.tabs[name] = tabPage = new DocPlus.TabPage(name, options);		}				tabPage.active();	},		openUrl: function(url, name){		name = DocPlus.nodes[name] ? DocPlus.nodes[name].getText() : name;				DocPlus.openTab(name, {			url: url		});	},		openName: function(name, basePath){		DocPlus.openUrl(basePath + name + '.html', name);	},		// 初始化		init: function(){				DocPlus.loadOptions();		DocPlus.initLayout();		DocPlus.initEvents();			},		/**	 * 初始化 splitter 的拖动事件。
	 */	initSplitter: function(){		var draggable = new Draggable(Dom.get('splitter'));				draggable.onDragStart = function (e) {
			this.target.addClass('x-splitter-proxy');			return true;
		};				draggable.onDrag = function () {			this.to.y = this.from.y;			this.to.x = Math.min(1000, Math.max(150, this.to.x));			return true;		};				draggable.onDragEnd = function () {			DocPlus.updateSplitter(this.to.x);			this.target.removeClass('x-splitter-proxy');			return true;		};	},		/**	 * 初始化左右布局。
	 */	initLayout: function(){		var opt = DocPlus.options;				DocPlus.initSplitter();		DocPlus.updateLayout();		DocPlus.reload();			},		initEvents: function(){		var win = new Dom(window);		win.on('unload', DocPlus.saveOptions);		win.on('hashchange', DocPlus.reload);		win.on('resize', DocPlus.updateLayout);	},		// 页面		reload: function(){		DocPlus.navigate(location.getHash());	},		navigate: function(href){		var baseName = href.substr(0, href.indexOf('/'));				switch(baseName) {			case 'examples':				DocPlus.openName(href, '../');				break;						}	},		// 树		trees: {},		urls: {},		nodes: {},		currentTree: null,		compileTree: function(data, parent, basePath){				if(data){			for(var n in data){				var an = n.split('::'),					url = basePath + '/' + an[1],					node = parent.nodes.add(an[0]).setHref(url);				DocPlus.nodes[url] = node;				DocPlus.compileTree(data[n], node, basePath) ;			}		}			},		toggleTree: function(t){		DocPlus.currentTree && DocPlus.currentTree.hide();		DocPlus.currentTree = t;	},		initTreeView: function(name, types){		Dom.ready(function(){							var t = DocPlus.trees[name] = new TreeView().addClass('x-treeview-plain').appendTo('doctree');			DocPlus.toggleTree(t);						DocPlus.compileTree(types, t, '#' + name);		})  ;	},		showTreeView: function(name){			}};Dom.ready(DocPlus.init);